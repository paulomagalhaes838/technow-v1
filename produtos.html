<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Produtos | Technow</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <script src="https://www.gstatic.com/firebasejs/9.6.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.4/firebase-database.js"></script>
  <script src="init-firebase.js"></script>

  <!-- Menu e WhatsApp (igual ao resto do site) -->

  <section class="produtos">
    <div class="container">
      <h2>Nossos Produtos</h2>
      <div class="busca">
        <input id="busca" placeholder="Buscar por nome…" />
      </div>
      <div class="filtros">
        <button class="filtro-btn active" data-categoria="todos">Todos</button>
        <button class="filtro-btn" data-categoria="celulares">Celulares</button>
        <button class="filtro-btn" data-categoria="notebooks">Notebooks</button>
        <button class="filtro-btn" data-categoria="upgrades">Upgrades</button>
      </div>
      <div id="lista-produtos" class="grid"></div>
    </div>
  </section>

  <script>
    // Referência ao node
    const prodRef = database.ref('produtos');
    const lista = document.getElementById('lista-produtos');
    const busca = document.getElementById('busca');

    function renderProduto(key, p) {
      const nome = p.nome.toLowerCase();
      const produto = document.createElement('div');
      produto.className = 'produto show';
      produto.dataset.categoria = p.categoria;
      produto.dataset.nome = nome;
      produto.innerHTML = `
        <img src="${p.imagem}" alt="${p.nome}" />
        <h4>${p.nome}</h4>
        <p>R$ ${p.preco}</p>
        <a href="https://wa.me/5511994545207?text=Olá! Quero saber sobre: ${p.nome}" class="btn">Comprar via WhatsApp</a>
      `;
      lista.appendChild(produto);
    }

    prodRef.on('value', snapshot => {
      lista.innerHTML = '';
      snapshot.forEach(item => renderProduto(item.key, item.val()));
      filtrar();
    });

    // Busca e filtros – igual à versão local anterior
    document.querySelectorAll('.filtro-btn').forEach(btn => {
      btn.onclick = () => {
        document.querySelector('.filtro-btn.active').classList.remove('active');
        btn.classList.add('active');
        filtrar();
      };
    });

    busca.oninput = filtrar;

    function filtrar() {
      const termo = busca.value.toLowerCase();
      const catSel = document.querySelector('.filtro-btn.active').dataset.categoria;
      document.querySelectorAll('.produto').forEach(prod => {
        const nm = prod.dataset.nome;
        const cat = prod.dataset.categoria;
        const okBusca = nm.includes(termo);
        const okCat = catSel === 'todos' || cat === catSel;
        prod.classList.toggle('show', okBusca && okCat);
      });
    }
  </script>

  <!-- Rodapé padrão -->
</body>
</html>
